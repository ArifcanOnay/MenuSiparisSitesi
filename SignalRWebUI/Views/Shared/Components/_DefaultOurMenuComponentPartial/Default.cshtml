@model List<ResultProductDto>
<section class="food_section layout_padding-bottom" style="padding-bottom: 200px; margin-bottom: 100px;">
    <div class="container">
        <div class="heading_container heading_center">
            <h2>
                Öne Çıkan Ürünlerimiz
            </h2>
            <p style="margin-top: 15px; color: #666; font-size: 16px;">
                Kategori seçerek ürünlerimizi filtreleyebilirsiniz
            </p>
        </div>

        <!-- ARAMA KUTUSU -->
        <div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
            <div style="max-width: 600px; margin: 0 auto; position: relative;">
                <input type="text" 
                       id="searchBox" 
                       placeholder="🔍 Ürün ara... (örn: burger, pizza)" 
                       style="width: 100%; padding: 15px 50px 15px 20px; font-size: 16px; border: 2px solid #ffbe33; border-radius: 30px; outline: none; box-shadow: 0 4px 10px rgba(255, 190, 51, 0.2);">
                <button onclick="document.getElementById('searchBox').value = ''; applySearchFilter();" 
                        style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; color: #ffbe33;">
                    ✕
                </button>
            </div>
            <p id="searchInfo" style="margin-top: 10px; color: #666; font-size: 14px;"></p>
        </div>

        <style>
            .filters_menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
                list-style: none;
                padding: 0;
                margin-bottom: 40px;
            }

            .filters_menu li {
                background: #f8f9fa;
                border: 2px solid #ffbe33;
                padding: 12px 30px;
                border-radius: 30px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                color: #222831;
                font-size: 16px;
            }

            .filters_menu li:hover {
                background: #ffbe33;
                color: white;
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(255, 190, 51, 0.3);
            }

            .filters_menu li.active {
                background: #ffbe33;
                color: white;
                box-shadow: 0 5px 15px rgba(255, 190, 51, 0.4);
            }

            .category-icon {
                margin-right: 8px;
            }

            .food_section .box {
                transition: all 0.3s ease;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            .food_section .box:hover {
                transform: translateY(-10px);
                box-shadow: 0 10px 30px rgba(255, 190, 51, 0.3);
            }

            .food_section .img-box {
                overflow: hidden;
                border-radius: 15px 15px 0 0;
            }

            .food_section .img-box img {
                transition: transform 0.3s ease;
            }

            .food_section .box:hover .img-box img {
                transform: scale(1.1);
            }
            
            .filters-content {
                min-height: 400px;
                padding: 20px 0 120px 0;
                margin-bottom: 100px;
            }
            
            .grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 30px !important;
                margin-bottom: 100px;
                padding: 0 15px;
                width: 100%;
            }
            
            @@media (max-width: 992px) {
                .grid {
                    grid-template-columns: repeat(2, 1fr) !important;
                }
            }
            
            @@media (max-width: 576px) {
                .grid {
                    grid-template-columns: 1fr !important;
                }
            }
            
            .grid > div[data-category] {
                width: 100% !important;
                margin-bottom: 0 !important;
                display: block !important;
            }
            
            .btn-box {
                margin-top: 80px;
                margin-bottom: 80px;
            }
            
            @@media (max-width: 992px) {
                .grid > div[data-category] {
                    flex: 0 0 calc(50% - 15px);
                    max-width: calc(50% - 15px);
                }
            }
            
            @@media (max-width: 576px) {
                .grid > div[data-category] {
                    flex: 0 0 100%;
                    max-width: 100%;
                }
            }
        </style>

        <ul class="filters_menu">
            <li class="active" data-filter="all" data-filter-type="category">
                <span class="category-icon">🍽️</span>
                Tümü
            </li>
            @{
                var categories = Model.Select(x => x.CategoryName).Distinct().ToList();
                foreach (var category in categories)
                {
                    var icon = category switch
                    {
                        "Hamburger" => "🍔",
                        "Pizza" => "🍕",
                        "Tatlı" => "🍰",
                        "Tatlılar" => "🍰",
                        "İçecek" => "🥤",
                        "İçecekler" => "🥤",
                        "Salata" => "🥗",
                        "Makarna" => "🍝",
                        "Başlangıç" => "🍴",
                        _ => "🍴"
                    };
                    <li data-filter="@category" data-filter-type="category">
                        <span class="category-icon">@icon</span>
                        @category
                    </li>
                }
            }
        </ul>
        
        <div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
            <label for="priceFilter" style="font-size: 18px; font-weight: 600; color: #222222; margin-right: 15px;">
                💰 Fiyata Göre:
            </label>
            <select id="priceFilter" style="padding: 10px 20px; font-size: 16px; border: 2px solid #ffbe33; border-radius: 25px; background: white; color: #222222; cursor: pointer; min-width: 200px; outline: none; font-weight: 500;">
                <option value="all">Tüm Fiyatlar</option>
                <option value="cheap">&lt; 150₺</option>
                <option value="medium">150₺ - 300₺</option>
                <option value="expensive">300₺+</option>
            </select>
        </div>

        <div class="filters-content">
            <div class="grid">
                @foreach(var item in Model)
                {
                <div data-category="@item.CategoryName" data-price="@item.Price" class="@item.CategoryName">
                    <div class="box">
                        <div>
                            <div class="img-box">
                                <img src="@item.ImageUrl" alt="">
                            </div>
                            <div class="detail-box">
                                <h5>
                                    @item.ProductName
                                </h5>
                                <p>
                                    @item.Description
                                </p>
                                <div class="options">
                                    <h6>
                                        @item.Price₺
                                    </h6>
                                    <a href="/CustomerTable/CustomerTableList/" class="btn btn-sm" style="background: #ffbe33; color: white; border-radius: 20px; padding: 6px 15px; font-weight: 600; font-size: 13px; white-space: nowrap;">
                                        <i class="fa fa-utensils"></i> Menü
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>
        
        <!-- SAYFALAMA -->
        <div id="pagination" style="text-align: center; margin-top: 40px; margin-bottom: 40px;">
            <button id="prevPage" onclick="changePage(-1)" style="background: #ffbe33; color: white; border: none; padding: 10px 20px; border-radius: 20px; margin: 0 5px; cursor: pointer; font-weight: 600;">
                ← Önceki
            </button>
            <span id="pageInfo" style="margin: 0 20px; font-size: 16px; font-weight: 600; color: #222;"></span>
            <button id="nextPage" onclick="changePage(1)" style="background: #ffbe33; color: white; border: none; padding: 10px 20px; border-radius: 20px; margin: 0 5px; cursor: pointer; font-weight: 600;">
                Sonraki →
            </button>
        </div>
        
        <!-- Tüm Menüyü Gör Butonu -->
        <div class="btn-box" style="text-align: center; margin-top: 40px; margin-bottom: 20px;">
            <a href="/Menu/Index/" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 12px 40px; border-radius: 30px; color: white; text-decoration: none; font-weight: bold; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);">
                📋 Tüm Menüyü Gör
            </a>
        </div>
        
        @if (ViewBag.MenuTableId != null && ViewBag.MenuTableId > 0)
        {
            <div class="btn-box">
                <a href="/Baskets/Index/@ViewBag.MenuTableId">
                    🛒 Sepetime Git
                </a>
            </div>
        }
        else
        {
            <div class="btn-box">
                <a href="/CustomerTable/CustomerTableList/">
                    Sipariş Vermek İçin Masa Seçin
                </a>
            </div>
        }
    </div>
</section>

<script>
    // GLOBAL DEĞİŞKENLER
    let currentPage = 1;
    const itemsPerPage = 6;
    let filteredProducts = [];
    let allProducts = [];
    let selectedCategory = 'all';
    let selectedPrice = 'all';
    let searchText = '';

    function addToBasket(productId, menuTableId) {
        if (!productId || !menuTableId) {
            alert('Hata: Ürün veya masa bilgisi eksik!');
            return false;
        }
        
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/Menu/AddBasket';
        
        var productInput = document.createElement('input');
        productInput.type = 'hidden';
        productInput.name = 'id';
        productInput.value = productId;
        form.appendChild(productInput);
        
        var tableInput = document.createElement('input');
        tableInput.type = 'hidden';
        tableInput.name = 'menuTableId';
        tableInput.value = menuTableId;
        form.appendChild(tableInput);
        
        document.body.appendChild(form);
        form.submit();
        
        return false;
    }
    
    // SAYFA DEĞİŞTİRME
    function changePage(direction) {
        const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
        
        if (direction === -1 && currentPage > 1) {
            currentPage--;
        } else if (direction === 1 && currentPage < totalPages) {
            currentPage++;
        }
        
        displayCurrentPage();
    }
    
    // MEVCUT SAYFAYI GÖSTER
    function displayCurrentPage() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
        
        // Tüm ürünleri gizle
        allProducts.forEach(product => {
            product.style.display = 'none';
        });
        
        // Sadece ilgili sayfadaki ürünleri göster
        filteredProducts.slice(startIndex, endIndex).forEach(product => {
            product.style.display = 'block';
        });
        
        // Sayfalama bilgisini güncelle
        document.getElementById('pageInfo').textContent = `Sayfa ${currentPage} / ${totalPages || 1} (${filteredProducts.length} ürün)`;
        
        // Buton durumlarını güncelle
        document.getElementById('prevPage').disabled = (currentPage === 1);
        document.getElementById('nextPage').disabled = (currentPage >= totalPages);
        
        // Arama bilgisi
        if (searchText) {
            document.getElementById('searchInfo').textContent = `"${searchText}" için ${filteredProducts.length} sonuç bulundu`;
        } else {
            document.getElementById('searchInfo').textContent = '';
        }
    }
    
    // FİLTRELEME FONKSİYONU
    function applyFilters() {
        filteredProducts = allProducts.filter(product => {
            const productCategory = product.getAttribute('data-category');
            const productPrice = parseFloat(product.getAttribute('data-price'));
            const productName = product.querySelector('.detail-box h5').textContent.toLowerCase();
            const productDesc = product.querySelector('.detail-box p').textContent.toLowerCase();
            
            // Kategori kontrolü
            let categoryMatch = (selectedCategory === 'all' || productCategory === selectedCategory);
            
            // Fiyat kontrolü
            let priceMatch = true;
            if (selectedPrice === 'cheap') priceMatch = (productPrice < 150);
            else if (selectedPrice === 'medium') priceMatch = (productPrice >= 150 && productPrice < 300);
            else if (selectedPrice === 'expensive') priceMatch = (productPrice >= 300);
            
            // Arama kontrolü
            let searchMatch = true;
            if (searchText) {
                searchMatch = productName.includes(searchText.toLowerCase()) || 
                             productDesc.includes(searchText.toLowerCase());
            }
            
            return categoryMatch && priceMatch && searchMatch;
        });
        
        currentPage = 1; // Filtrelemede ilk sayfaya dön
        displayCurrentPage();
    }
    
    // ARAMA FONKSİYONU
    function applySearchFilter() {
        searchText = document.getElementById('searchBox').value.trim();
        applyFilters();
    }
    
    document.addEventListener('DOMContentLoaded', function () {
        // Tüm ürünleri array'e al
        allProducts = Array.from(document.querySelectorAll('.grid > div[data-category]'));
        
        // İlk yüklemede "Tümü" filtresini uygula
        applyFilters();
        
        // Arama kutusuna event listener
        document.getElementById('searchBox').addEventListener('input', applySearchFilter);
        
        // Kategori butonları
        const filterButtons = document.querySelectorAll('.filters_menu li');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                selectedCategory = this.getAttribute('data-filter');
                applyFilters();
            });
        });
        
        // Fiyat dropdown
        const priceFilter = document.getElementById('priceFilter');
        if (priceFilter) {
            priceFilter.addEventListener('change', function() {
                selectedPrice = this.value;
                applyFilters();
            });
        }
    });
</script>
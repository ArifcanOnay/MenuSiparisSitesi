@model List<ResultProductDto>
<section class="food_section layout_padding-bottom" style="padding-bottom: 200px; margin-bottom: 100px;">
    <div class="container">
        <div class="heading_container heading_center">
            <h2>
                Öne Çıkan Ürünlerimiz
            </h2>
            <p style="margin-top: 15px; color: #666; font-size: 16px;">
                Kategori seçerek ürünlerimizi filtreleyebilirsiniz
            </p>
        </div>

        <style>
            .filters_menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
                list-style: none;
                padding: 0;
                margin-bottom: 40px;
            }

            .filters_menu li {
                background: #f8f9fa;
                border: 2px solid #ffbe33;
                padding: 12px 30px;
                border-radius: 30px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                color: #222831;
                font-size: 16px;
            }

            .filters_menu li:hover {
                background: #ffbe33;
                color: white;
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(255, 190, 51, 0.3);
            }

            .filters_menu li.active {
                background: #ffbe33;
                color: white;
                box-shadow: 0 5px 15px rgba(255, 190, 51, 0.4);
            }

            .category-icon {
                margin-right: 8px;
            }

            .food_section .box {
                transition: all 0.3s ease;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            .food_section .box:hover {
                transform: translateY(-10px);
                box-shadow: 0 10px 30px rgba(255, 190, 51, 0.3);
            }

            .food_section .img-box {
                overflow: hidden;
                border-radius: 15px 15px 0 0;
            }

            .food_section .img-box img {
                transition: transform 0.3s ease;
            }

            .food_section .box:hover .img-box img {
                transform: scale(1.1);
            }
            
            .filters-content {
                min-height: 400px;
                padding: 20px 0 120px 0;
                margin-bottom: 100px;
            }
            
            .grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 30px !important;
                margin-bottom: 100px;
                padding: 0 15px;
                width: 100%;
            }
            
            @@media (max-width: 992px) {
                .grid {
                    grid-template-columns: repeat(2, 1fr) !important;
                }
            }
            
            @@media (max-width: 576px) {
                .grid {
                    grid-template-columns: 1fr !important;
                }
            }
            
            .grid > div[data-category] {
                width: 100% !important;
                margin-bottom: 0 !important;
                display: block !important;
            }
            
            .btn-box {
                margin-top: 80px;
                margin-bottom: 80px;
            }
            
            @@media (max-width: 992px) {
                .grid > div[data-category] {
                    flex: 0 0 calc(50% - 15px);
                    max-width: calc(50% - 15px);
                }
            }
            
            @@media (max-width: 576px) {
                .grid > div[data-category] {
                    flex: 0 0 100%;
                    max-width: 100%;
                }
            }
        </style>

        <ul class="filters_menu">
            <li class="active" data-filter="all" data-filter-type="category">
                <span class="category-icon">🍽️</span>
                Tümü
            </li>
            @{
                var categories = Model.Select(x => x.CategoryName).Distinct().ToList();
                foreach (var category in categories)
                {
                    var icon = category switch
                    {
                        "Hamburger" => "🍔",
                        "Pizza" => "🍕",
                        "Tatlı" => "🍰",
                        "Tatlılar" => "🍰",
                        "İçecek" => "🥤",
                        "İçecekler" => "🥤",
                        "Salata" => "🥗",
                        "Makarna" => "🍝",
                        "Başlangıç" => "🍴",
                        _ => "🍴"
                    };
                    <li data-filter="@category" data-filter-type="category">
                        <span class="category-icon">@icon</span>
                        @category
                    </li>
                }
            }
        </ul>
        
        <div style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
            <label for="priceFilter" style="font-size: 18px; font-weight: 600; color: #222222; margin-right: 15px;">
                💰 Fiyata Göre:
            </label>
            <select id="priceFilter" style="padding: 10px 20px; font-size: 16px; border: 2px solid #ffbe33; border-radius: 25px; background: white; color: #222222; cursor: pointer; min-width: 200px; outline: none; font-weight: 500;">
                <option value="all">Tüm Fiyatlar</option>
                <option value="cheap">&lt; 150₺</option>
                <option value="medium">150₺ - 300₺</option>
                <option value="expensive">300₺+</option>
            </select>
        </div>

        <div class="filters-content">
            <div class="grid">
                @foreach(var item in Model)
                {
                <div data-category="@item.CategoryName" data-price="@item.Price" class="@item.CategoryName">
                    <div class="box">
                        <div>
                            <div class="img-box">
                                <img src="@item.ImageUrl" alt="">
                            </div>
                            <div class="detail-box">
                                <h5>
                                    @item.ProductName
                                </h5>
                                <p>
                                    @item.Description
                                </p>
                                <div class="options">
                                    <h6>
                                        @item.Price₺
                                    </h6>
                                    <a href="/CustomerTable/CustomerTableList/" class="btn btn-sm" style="background: #ffbe33; color: white; border-radius: 20px; padding: 6px 15px; font-weight: 600; font-size: 13px; white-space: nowrap;">
                                        <i class="fa fa-utensils"></i> Menü
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>
        
        <!-- Tüm Menüyü Gör Butonu -->
        <div class="btn-box" style="text-align: center; margin-top: 40px; margin-bottom: 20px;">
            <a href="/Menu/Index/" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 12px 40px; border-radius: 30px; color: white; text-decoration: none; font-weight: bold; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);">
                📋 Tüm Menüyü Gör
            </a>
        </div>
        
        @if (ViewBag.MenuTableId != null && ViewBag.MenuTableId > 0)
        {
            <div class="btn-box">
                <a href="/Baskets/Index/@ViewBag.MenuTableId">
                    🛒 Sepetime Git
                </a>
            </div>
        }
        else
        {
            <div class="btn-box">
                <a href="/CustomerTable/CustomerTableList/">
                    Sipariş Vermek İçin Masa Seçin
                </a>
            </div>
        }
    </div>
</section>

<script>
    function addToBasket(productId, menuTableId) {
        if (!productId || !menuTableId) {
            alert('Hata: Ürün veya masa bilgisi eksik!');
            return false;
        }
        
        // Form oluştur ve gönder
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/Menu/AddBasket';
        
        var productInput = document.createElement('input');
        productInput.type = 'hidden';
        productInput.name = 'id';
        productInput.value = productId;
        form.appendChild(productInput);
        
        var tableInput = document.createElement('input');
        tableInput.type = 'hidden';
        tableInput.name = 'menuTableId';
        tableInput.value = menuTableId;
        form.appendChild(tableInput);
        
        document.body.appendChild(form);
        form.submit();
        
        return false;
    }
    
    // Kategori ve Fiyat Filtreleme (Vanilla JavaScript)
    document.addEventListener('DOMContentLoaded', function () {
        console.log("Filtreleme başlatıldı");
        
        // Filtreleme durumları
        let selectedCategory = 'all';
        let selectedPrice = 'all';
        
        // Tüm ürünleri al
        const allProducts = document.querySelectorAll('.grid > div[data-category]');
        
        // İlk yüklemede sadece ilk 6 ürünü göster
        allProducts.forEach((product, index) => {
            if (index < 6) {
                product.style.cssText = 'display: block !important;';
            } else {
                product.style.cssText = 'display: none !important;';
            }
            console.log("Ürün " + index + " kategorisi:", product.getAttribute('data-category'), "Fiyatı:", product.getAttribute('data-price'));
        });
        
        // Filtreleme fonksiyonu
        function applyFilters() {
            console.log("=== FİLTRELEME BAŞLADI ===");
            console.log("Seçili Kategori:", selectedCategory);
            console.log("Seçili Fiyat:", selectedPrice);
            
            const products = document.querySelectorAll('.grid > div[data-category]');
            let visibleCount = 0;
            
            products.forEach(product => {
                const productCategory = product.getAttribute('data-category');
                const productPrice = parseFloat(product.getAttribute('data-price'));
                
                console.log("Kontrol edilen ürün - Kategori:", productCategory, "Fiyat:", productPrice);
                
                let categoryMatch = false;
                let priceMatch = false;
                
                // Kategori filtresi kontrolü
                if (selectedCategory === 'all') {
                    categoryMatch = true;
                } else {
                    categoryMatch = (productCategory === selectedCategory);
                }
                
                // Fiyat filtresi kontrolü
                if (selectedPrice === 'all') {
                    priceMatch = true;
                } else if (selectedPrice === 'cheap') {
                    priceMatch = (productPrice >= 0 && productPrice < 150);
                    console.log("Cheap kontrolü:", productPrice, "< 150 =", priceMatch);
                } else if (selectedPrice === 'medium') {
                    priceMatch = (productPrice >= 150 && productPrice < 300);
                    console.log("Medium kontrolü:", productPrice, ">= 150 && < 300 =", priceMatch);
                } else if (selectedPrice === 'expensive') {
                    priceMatch = (productPrice >= 300);
                    console.log("Expensive kontrolü:", productPrice, ">= 300 =", priceMatch);
                }
                
                console.log("categoryMatch:", categoryMatch, "priceMatch:", priceMatch);
                
                // Her iki filtre de uyuyorsa göster
                if (categoryMatch && priceMatch) {
                    // "Tümü" seçiliyse sadece ilk 6 ürünü göster
                    if (selectedCategory === 'all' && selectedPrice === 'all') {
                        if (visibleCount < 6) {
                            product.style.cssText = 'display: block !important;';
                            visibleCount++;
                            console.log("Gösteriliyor (ilk 6'dan)");
                        } else {
                            product.style.cssText = 'display: none !important;';
                            console.log("Gizleniyor (6+ ürün)");
                        }
                    } else {
                        // Filtreleme varsa hepsini göster
                        product.style.cssText = 'display: block !important;';
                        visibleCount++;
                        console.log("Gösteriliyor (filtre uyuyor)");
                    }
                } else {
                    product.style.cssText = 'display: none !important;';
                    console.log("Gizleniyor (filtre uymuyor)");
                }
            });
            
            console.log("=== TOPLAM GÖRÜNEN ÜRÜN:", visibleCount, "===");
        }
        
        // Kategori butonlarına tıklama olayı
        const filterButtons = document.querySelectorAll('.filters_menu li');
        console.log("Bulunan kategori butonu sayısı:", filterButtons.length);
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                console.log("Kategori butonuna tıklandı");
                
                const filterType = this.getAttribute('data-filter-type');
                const filterValue = this.getAttribute('data-filter');
                
                // Kategori filtresinde aktif sınıfı değiştir
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Seçilen kategoriyi kaydet
                if (filterType === 'category') {
                    selectedCategory = filterValue;
                }
                
                console.log("Seçilen kategori:", filterValue);
                
                // Filtreleri uygula
                applyFilters();
            });
        });
        
        // Fiyat dropdown'ına change olayı
        const priceFilter = document.getElementById('priceFilter');
        console.log("Fiyat dropdown elementi:", priceFilter);
        
        if (priceFilter) {
            console.log("Dropdown bulundu, event listener ekleniyor...");
            
            priceFilter.addEventListener('change', function(e) {
                console.log("Change event tetiklendi!");
                console.log("Event:", e);
                console.log("this.value:", this.value);
                console.log("e.target.value:", e.target.value);
                
                selectedPrice = this.value;
                console.log("Dropdown değişti! Seçilen fiyat aralığı:", selectedPrice);
                
                // Filtreleri uygula
                applyFilters();
            });
            
            // Direkt onchange de deneyelim
            priceFilter.onchange = function() {
                console.log("onchange tetiklendi!");
                selectedPrice = this.value;
                console.log("Yeni seçim:", selectedPrice);
                applyFilters();
            };
        } else {
            console.error("Fiyat dropdown bulunamadı!");
        }
    });
</script>